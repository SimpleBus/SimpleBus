<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>SimpleBus/RabbitMQBundleBridge</title>

        <link rel="stylesheet" href="http://simplebus.github.io/RabbitMQBundleBridge/css/bootstrap.min.css">
        <link rel="stylesheet" href="http://simplebus.github.io/RabbitMQBundleBridge/css/font-awesome.min.css">
        <link rel="stylesheet" href="http://simplebus.github.io/RabbitMQBundleBridge/css/highlight.dark.css">
        <link rel="stylesheet" href="http://simplebus.github.io/RabbitMQBundleBridge/css/main.css">
    </head>
    <body>

        <header class="navbar navbar-default navbar-fixed-top">

            <a class="navbar-brand" href="http://simplebus.github.io/RabbitMQBundleBridge/">
                SimpleBus/RabbitMQBundleBridge
                <small class="hidden-xs hidden-sm">
                    Use OldSoundRabbitMQBundle with SimpleBus/AsynchronousBundle
                </small>
            </a>

            
        </header>

        <main class="container-fluid">
            <div class="row">

                
                    <nav id="sidebar" class="col-sm-3 col-lg-2" role="navigation">

                        <ul class="nav nav-pills nav-stacked">
                                                            <li class="">
                                    <a href="http://simplebus.github.io/RabbitMQBundleBridge/">
                                        Home
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="http://simplebus.github.io/RabbitMQBundleBridge/doc/getting_started.html">
                                        Getting started
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="http://simplebus.github.io/RabbitMQBundleBridge/doc/events.html">
                                        Events
                                    </a>
                                </li>
                                                            <li class="active">
                                    <a href="http://simplebus.github.io/RabbitMQBundleBridge/doc/routing.html">
                                        Routing
                                    </a>
                                </li>
                                                    </ul>

                    </nav>

                
                <section id="content" class="col-sm-offset-3 col-lg-offset-2 col-sm-9 col-lg-10">
                    <h1>Routing</h1>
<p>By default, this bundle assumes that you want to use "direct" exchanges and use one queue for all commands, and one
queue for all events. If you want to use "topic" exchanges and selectively consume messages using a routing key, this
bundle can generate routing keys automatically for you based on the class name of the <code>Message</code>. Just change the
bundle configuration:</p>
<pre><code class="language-yaml"># in config.yml
simple_bus_rabbit_mq:
    # default value is "empty"
    routing_key_resolver: class_based</code></pre>
<p>When for example a <code>Message</code> of class <code>Acme\Command\RegisterUser</code> is published to the queue, its routing key will be
<code>Acme.Command.RegisterUser</code>. Now you can define consumers for specific messages, based on this routing key:</p>
<pre><code class="language-yaml"># in config.yml
old_sound_rabbit_mq:
    ...
    consumers:
        acme_commands:
            connection:       default
            exchange_options: { name: 'asynchronous_commands', type: topic }
            queue_options:    { name: 'asynchronous_commands', routing_keys: ['Acme.Command.#'] }
            callback:         simple_bus.rabbit_mq_bundle_bridge.events_consumer</code></pre>
<h2 id="custom-routing-keys">Custom routing keys</h2>
<p>If you want to define routing keys in a custom way (not based on the class of a <code>Message</code>), create a class that
implements <code>RoutingKeyResolver</code>:</p>
<pre><code class="language-php">use SimpleBus\RabbitMQBundleBridge\Routing\RoutingKeyResolver;
use SimpleBus\Message\Message;

class MyCustomRoutingKeyResolver implements RoutingKeyResolver
{
    public function resolveRoutingKeyFor(Message $message)
    {
        // determine the routing key for the given Message
        return ...;

        // if you don't want to use a specific routing key, return an empty string
    }
}</code></pre>
<p>Now register this class as a service:</p>
<pre><code class="language-yaml">services:
    my_custom_routing_key_resolver:
        class: MyCustomRoutingKeyResolver</code></pre>
<p>Finally, mention your routing key resolver service id in the bundle configuration:</p>
<pre><code class="language-yaml"># in config.yml
simple_bus_rabbit_mq_bundle_bridge:
    routing_key_resolver: my_custom_routing_key_resolver</code></pre>
<blockquote>
<h2 id="fair-dispatching">Fair dispatching</h2>
<p>If you are looking for a way to evenly distribute messages over several workers, you may not be better off using a
"topic" exchange. Instead, you could just use a "direct" exchange, spin up several workers, and configure
consumers to prefetch only one message at a time:</p>
<pre><code class="language-yaml"># in config.yml
old_sound_rabbit_mq:
    consumers:
        ...
        asynchronous_commands:
            ...
            qos_options:
                prefetch_count: 1</code></pre>
<p>See also <a href="https://github.com/videlalvaro/RabbitMqBundle#fair-dispatching">Fair dispatching</a> in the bundle's official
documentation.</p>
</blockquote>
                </section>

            </div>
        </main>

        <footer>
            <div class="container-fluid">
                <p class="text-muted">
                    website generated with <a href="http://couscous.io" title="Markdown website generator">Couscous</a>
                </p>
            </div>
        </footer>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="http://yastatic.net/highlightjs/8.2/highlight.min.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                // Syntax highlighting
                hljs.initHighlightingOnLoad();
            });
        </script>

    </body>
</html>
